<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Curve Animation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
        }
        .container {
            text-align: center;
        }
        canvas {
            border: 1px solid #ccc;
            margin-top: 20px;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 8px 16px;
            margin: 0 10px;
            cursor: pointer;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
        }
        input[type="range"] {
            width: 300px;
        }
        .title {
            margin-bottom: 5px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Heart Curve Animation</h1>
        <div class="controls">
            <button id="playPauseBtn">Pause</button>
            <button id="resetBtn">Reset</button>
            <div>
                <label for="speedSlider">Animation Speed: </label>
                <input type="range" id="speedSlider" min="1" max="200" value="100">
            </div>
            <div>
                <label for="manualSlider">Parameter a: </label>
                <input type="range" id="manualSlider" min="1" max="20" step="0.1" value="1">
                <span id="aValue">1.0</span>
            </div>
        </div>
        <div class="title" id="curveTitle">a = 1.00</div>
        <div id="sketch-holder"></div>
    </div>

    <script>
        let a = 1.0;
        let isPlaying = true;
        let speed = 100;
        let manualMode = false;

        function setup() {
            const canvas = createCanvas(600, 500);
            canvas.parent('sketch-holder');
            frameRate(30);
            
            // Set up controls
            const playPauseBtn = document.getElementById('playPauseBtn');
            playPauseBtn.addEventListener('click', () => {
                isPlaying = !isPlaying;
                playPauseBtn.textContent = isPlaying ? 'Pause' : 'Play';
                manualMode = !isPlaying;
            });
            
            const resetBtn = document.getElementById('resetBtn');
            resetBtn.addEventListener('click', () => {
                a = 1.0;
                document.getElementById('manualSlider').value = 1.0;
                document.getElementById('aValue').textContent = '1.0';
                manualMode = false;
                isPlaying = true;
                playPauseBtn.textContent = 'Pause';
            });
            
            const speedSlider = document.getElementById('speedSlider');
            speedSlider.addEventListener('input', () => {
                speed = parseInt(speedSlider.value);
            });
            
            const manualSlider = document.getElementById('manualSlider');
            manualSlider.addEventListener('input', () => {
                a = parseFloat(manualSlider.value);
                document.getElementById('aValue').textContent = a.toFixed(1);
                manualMode = true;
                isPlaying = false;
                playPauseBtn.textContent = 'Play';
            });
        }

        function draw() {
            background(255);
            
            // Update parameter a
            if (isPlaying) {
                a += 0.01 * (speed / 100);
                if (a > 20) a = 1;
                document.getElementById('manualSlider').value = a;
                document.getElementById('aValue').textContent = a.toFixed(1);
            }
            
            // Calculate and draw the curve
            translate(width / 2, height / 2);
            scale(100, -100);  // Scale up and flip y-axis
            
            let hasComplex = false;
            
            // Draw axes
            stroke(200);
            strokeWeight(0.01);
            line(-3, 0, 3, 0);
            line(0, -3, 0, 3);
            
            // Draw the curve
            stroke(255, 0, 0);
            strokeWeight(0.02);
            noFill();
            
            beginShape();
            for (let i = -2; i <= 2; i += 0.01) {
                let x = i;
                let term1 = Math.pow(Math.pow(x, 2), 1/3);
                let term2 = Math.E / 3 * Math.sqrt(Math.max(0, Math.PI - x*x)) * Math.sin(a * Math.PI * x);
                let y = term1 + term2;
                
                // Check if result is complex (when PI - x^2 < 0)
                if (Math.PI - x*x < 0) {
                    hasComplex = true;
                    continue;  // Skip this point
                }
                
                vertex(x, y);
            }
            endShape();
            
            // Update title
            let titleText = `a = ${a.toFixed(2)}`;
            if (hasComplex) {
                titleText += " (complex results present)";
            }
            document.getElementById('curveTitle').textContent = titleText;
        }
    </script>
</body>
</html>
